<project name="BNUWebBot" default="deploy" basedir=".">
	<property file="build.properties"/>
	<property name="lib" value="WEB-INF/lib" />
	<property name="build" value="c:/build.tmp" />

	<path id="classpath">
		<pathelement location="${build}"/>
		<pathelement location="src"/>
		<pathelement location="${GWT_HOME}/gwt-user.jar"/>
		<pathelement location="${GWT_HOME}/gwt-dev-windows.jar"/>
		<pathelement location="${GWT_HOME}/gwt-servlet.jar"/>
		<fileset dir="${lib}">
			<include name="**/*.jar"/>
		</fileset>
	</path>

	<target name="clean" description="deletes all generated files">
		<delete dir=".gwt-cache"/> <!-- generated by GWT -->
		<delete dir="${build}"/> <!-- generated by the prepare target -->
	</target>

	<target name="compile" depends="prepare" description="compiles Java source files to bytecode">
		<javac classpathref="classpath"
			srcdir="src"
			destdir="${build}"
			debug="on"
			optimize="true"
			failonerror="true"/>
	</target>

	<target name="compile.gwt" depends="compile" description="compiles Java source files to JavaScript">
		<java classname="com.google.gwt.dev.GWTCompiler" classpathref="classpath" fork="true" failonerror="true">
			<jvmarg line="-Xms256m -Xmx512m"/>
			<!-- <arg line="-logLevel INFO"/> -->
			<!-- <arg line="-gen build/review"/> -->
			<arg line="-out ${build}/www"/>
			<!-- <arg line="-treeLogger"/> -->
			<!-- <arg line="-style OBFUSCATE"/> -->
			<!-- <arg value="${module}"/> -->
			<arg value="${package}.${module}"/>
		</java>
	</target>

	<target name="deploy" depends="war" description="deploys the war file to Tomcat">
		<copy file="${build}/${war}" todir="${deploy}"/>
		<echo>browse ${url}</echo>
	</target>

	<target name="prepare" description="creates output directories">
		<mkdir dir="${build}"/>
	</target>

	<target name="war" depends="compile, compile.gwt"
		description="builds the war file">
		<delete file="${build}/${war}"/>
		<war warfile="${build}/${war}" webxml="WEB-INF/web.xml">
			<!-- cayenne config -->
			<classes dir="src" includes="**/*.xml" />
			<!-- bytecode from your Java code -->
			<classes dir="${build}" includes="**/*.class"/>
			<!-- generated HTML/JavaScript plus your CSS -->
			<fileset dir="${build}/www/${package}.${module}"/>
			<!-- supplied JAR -->
			<lib file="${GWT_HOME}/gwt-servlet.jar"/>
			<lib dir="${lib}">
					<include name="**/*.jar"/>
			</lib>
		</war> 
	</target>
</project> 